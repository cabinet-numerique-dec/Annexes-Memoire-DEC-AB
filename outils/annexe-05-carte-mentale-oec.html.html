<!DOCTYPE html>
<html lang="fr">
<head>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Annexe 5 ‚Äî √âcosyst√®me professionnel du cabinet 100 % num√©rique</title>
  <style>
    :root {
      --primary: #1e3a5f;
      --primary-light: #2d5a8a;
      --secondary: #0d9488;
      --secondary-light: #14b8a6;
      --accent: #f59e0b;
      --danger: #dc2626;
      --success: #059669;
      --warning: #d97706;
      --info: #2563eb;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--gray-100) 0%, #e0e7ef 100%);
      color: var(--gray-700);
      line-height: 1.6;
      min-height: 100vh;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 24px; }

    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border-radius: var(--radius);
      padding: 32px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }
    .header::before {
      content: "";
      position: absolute;
      top: -50%;
      right: -10%;
      width: 300px;
      height: 300px;
      background: rgba(255,255,255,0.05);
      border-radius: 50%;
    }
    .header h1 { font-size: 22px; font-weight: 700; margin-bottom: 8px; position: relative; }
    .header p { opacity: 0.9; font-size: 14px; max-width: 900px; position: relative; }
    .header-meta { display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.15);
      padding: 6px 14px; border-radius: 20px;
      font-size: 12px; font-weight: 600;
    }
    .badge-accent { background: var(--secondary); color: white; }

    .context-box {
      background: rgba(255,255,255,0.1);
      border-left: 4px solid var(--accent);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin-top: 20px;
    }
    .context-box p { font-size: 13px; margin-bottom: 6px; opacity: 0.95; }
    .context-box p:last-child { margin-bottom: 0; }

    .action-bar { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 24px; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 12px 24px; border: none; border-radius: 8px;
      font-size: 14px; font-weight: 600; cursor: pointer;
      transition: all 0.2s; text-decoration: none;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-light); transform: translateY(-2px); box-shadow: var(--shadow); }
    .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
    .btn-secondary:hover { background: var(--gray-300); transform: translateY(-2px); }
    .btn-success { background: var(--success); color: white; }
    .btn-success:hover { background: #047857; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover { background: #b91c1c; }

    .tabs {
      display: flex; gap: 4px; background: white; padding: 8px;
      border-radius: var(--radius); box-shadow: var(--shadow);
      margin-bottom: 24px; flex-wrap: wrap;
    }
    .tab {
      padding: 10px 16px; border: none; background: transparent;
      font-size: 13px; font-weight: 600; color: var(--gray-600);
      border-radius: 8px; cursor: pointer; transition: all 0.2s;
      white-space: nowrap;
    }
    .tab:hover { background: var(--gray-100); }
    .tab.active { background: var(--primary); color: white; }

    .panel { display: none; animation: fadeIn 0.3s ease; }
    .panel.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .card {
      background: white; border-radius: var(--radius);
      padding: 24px; box-shadow: var(--shadow); margin-bottom: 20px;
    }
    .card-header {
      display: flex; align-items: center; gap: 12px;
      margin-bottom: 16px; padding-bottom: 16px;
      border-bottom: 1px solid var(--gray-200);
    }
    .card-icon {
      width: 48px; height: 48px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      border-radius: 10px; display: flex; align-items: center; justify-content: center;
      font-size: 22px; color: white; flex-shrink: 0;
    }
    .card-icon.secondary { background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%); }
    .card-icon.accent { background: linear-gradient(135deg, var(--accent) 0%, #fbbf24 100%); }
    .card-icon.danger { background: linear-gradient(135deg, var(--danger) 0%, #ef4444 100%); }
    .card-icon.success { background: linear-gradient(135deg, var(--success) 0%, #34d399 100%); }
    .card-icon.info { background: linear-gradient(135deg, var(--info) 0%, #60a5fa 100%); }
    .card h3 { font-size: 18px; font-weight: 700; color: var(--gray-800); }
    .card .subtitle { color: var(--gray-500); font-size: 13px; margin-top: 2px; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
    .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }

    .stat-card {
      background: white; border-radius: var(--radius); padding: 20px;
      box-shadow: var(--shadow); text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .stat-value {
      font-size: 28px; font-weight: 800;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .stat-label { font-size: 12px; color: var(--gray-600); margin-top: 4px; font-weight: 500; }
    .stat-trend { font-size: 11px; margin-top: 8px; padding: 4px 10px; border-radius: 20px; display: inline-block; }
    .stat-trend.up { background: #d1fae5; color: var(--success); }
    .stat-trend.down { background: #fee2e2; color: var(--danger); }
    .stat-trend.neutral { background: var(--gray-100); color: var(--gray-600); }

    .profil-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin: 20px 0; }
    .profil-field label { display: block; font-size: 12px; font-weight: 600; color: var(--gray-600); margin-bottom: 6px; }
    .profil-field select, .profil-field input {
      width: 100%; padding: 10px 14px; border: 2px solid var(--gray-200);
      border-radius: 8px; font-size: 14px; background: white;
      transition: border-color 0.2s;
    }
    .profil-field select:focus, .profil-field input:focus { outline: none; border-color: var(--primary); }

    /* ========== CARTE MENTALE ========== */
.mindmap-wrapper {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border-radius: var(--radius);
  padding: 18px 14px;
  margin: 12px 0;
  overflow-x: auto;
}

.mindmap-grid {
  display: grid;
  grid-template-columns: 180px 1fr 180px;
  grid-template-rows: auto auto auto;
  gap: 8px;
  min-width: 780px;
  max-width: 1020px;
  margin: 0 auto;
}

.mindmap-center-zone {
  grid-column: 2;
  grid-row: 2;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 160px;
}

.mindmap-center {
  width: 138px;
  height: 138px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
  border-radius: 50%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  text-align: center;
  box-shadow: 0 6px 20px rgba(30, 58, 95, 0.4);
  cursor: pointer;
  transition: transform 0.3s;
  border: 3px solid rgba(255,255,255,0.25);
}
.mindmap-center:hover { transform: scale(1.05); }
.mindmap-center-icon { font-size: 28px; margin-bottom: 4px; }
.mindmap-center-text { font-size: 13px; font-weight: 700; line-height: 1.2; }
.mindmap-center-sub { font-size: 10px; opacity: 0.85; margin-top: 2px; }

.mindmap-branch {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.mindmap-branch.top {
  grid-column: 2;
  grid-row: 1;
  flex-direction: row;
  justify-content: center;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-end;
}

.mindmap-branch.left {
  grid-column: 1;
  grid-row: 2;
  align-items: flex-end;
  justify-content: center;
  padding-right: 0;
}

.mindmap-branch.right {
  grid-column: 3;
  grid-row: 2;
  align-items: flex-start;
  justify-content: center;
  padding-left: 0;
}

.mindmap-branch.bottom {
  grid-column: 2;
  grid-row: 3;
  flex-direction: row;
  justify-content: center;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-start;
}

.mindmap-cat-label {
  padding: 5px 14px;
  border-radius: 14px;
  font-size: 11px;
  font-weight: 700;
  color: white;
  text-align: center;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.12);
}
.mindmap-cat-label.ordinal { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); }
.mindmap-cat-label.dispositif { background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%); }
.mindmap-cat-label.obligation { background: linear-gradient(135deg, var(--danger) 0%, #ef4444 100%); }
.mindmap-cat-label.reseau { background: linear-gradient(135deg, var(--info) 0%, #60a5fa 100%); }

.mindmap-node {
  background: white;
  border-radius: 8px;
  padding: 8px 10px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid transparent;
  min-width: 110px;
  max-width: 140px;
}
.mindmap-node:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}
.mindmap-node.ordinal { border-color: var(--primary); }
.mindmap-node.dispositif { border-color: var(--secondary); }
.mindmap-node.obligation { border-color: var(--danger); }
.mindmap-node.reseau { border-color: var(--info); }

.mindmap-node-icon { font-size: 20px; margin-bottom: 3px; }
.mindmap-node-text { 
  font-size: 12px; 
  font-weight: 600; 
  color: var(--gray-800); 
  line-height: 1.25;
}
.mindmap-node-tag {
  font-size: 9px;
  margin-top: 4px;
  padding: 2px 8px;
  border-radius: 6px;
  display: inline-block;
  font-weight: 600;
  text-transform: uppercase;
}
.mindmap-node-tag.obligatoire { background: #fef2f2; color: var(--danger); }
.mindmap-node-tag.recommand√© { background: #fffbeb; color: var(--warning); }
.mindmap-node-tag.optionnel { background: #eff6ff; color: var(--info); }
.mindmap-node-tag.cac { background: #f3e8ff; color: #7c3aed; }
.mindmap-node-tag.conditionnel { background: #fef3c7; color: #92400e; }
.mindmap-node-tag.gratuit { background: #ecfdf5; color: #059669; }

.mindmap-nodes-row {
  display: flex;
  gap: 6px;
  justify-content: center;
  flex-wrap: wrap;
}

.mindmap-legend {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 10px;
  flex-wrap: wrap;
  padding-top: 10px;
  border-top: 1px dashed var(--gray-300);
}
.mindmap-legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  color: var(--gray-600);
  font-weight: 500;
}
.mindmap-legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

    /* ========== SIMULATEUR ========== */
    .simulator-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    @media (max-width: 900px) { .simulator-grid { grid-template-columns: 1fr; } }
    
    .simulator-section { 
      background: var(--gray-50); 
      border-radius: 12px; 
      padding: 20px;
    }
    .simulator-section h4 { 
      font-size: 14px; 
      font-weight: 700; 
      color: var(--gray-800); 
      margin-bottom: 16px; 
      display: flex; 
      align-items: center; 
      gap: 8px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--gray-200);
    }
    
    .simulator-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 0;
      border-bottom: 1px dashed var(--gray-200);
      gap: 12px;
    }
    .simulator-item:last-child { border-bottom: none; }
    .simulator-item.disabled { opacity: 0.5; }
    
    .simulator-item-left {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 0;
    }
    .simulator-item-check {
      width: 22px;
      height: 22px;
      cursor: pointer;
      flex-shrink: 0;
    }
    .simulator-item-info {
      flex: 1;
      min-width: 0;
    }
    .simulator-item-label {
      font-size: 14px;
      color: var(--gray-800);
      font-weight: 600;
    }
    .simulator-item-sublabel {
      font-size: 11px;
      color: var(--gray-500);
      margin-top: 2px;
    }
    
    .simulator-item-amount {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-shrink: 0;
    }
    .simulator-item-amount input {
      width: 90px;
      padding: 8px 10px;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      color: var(--gray-800);
      text-align: right;
      transition: border-color 0.2s;
    }
    .simulator-item-amount input:focus {
      outline: none;
      border-color: var(--primary);
    }
    .simulator-item-amount input:disabled {
      background: var(--gray-100);
      color: var(--gray-500);
    }
    .simulator-item-amount .currency {
      font-size: 13px;
      color: var(--gray-600);
      font-weight: 600;
    }
    .simulator-item-amount.free {
      color: var(--success);
      font-weight: 700;
      font-size: 14px;
    }

    .simulator-total {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border-radius: 12px;
      padding: 24px;
      margin-top: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .simulator-total-label { font-size: 16px; font-weight: 600; }
    .simulator-total-amount { font-size: 32px; font-weight: 800; }
    .simulator-total-sub { font-size: 12px; opacity: 0.8; margin-top: 4px; }

    .simulator-timeline {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 2px solid var(--gray-200);
    }
    .simulator-timeline h4 {
      font-size: 14px;
      font-weight: 700;
      color: var(--gray-800);
      margin-bottom: 16px;
    }
    .timeline-bar {
      display: flex;
      height: 50px;
      border-radius: 10px;
      overflow: hidden;
      background: var(--gray-100);
    }
    .timeline-segment {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: white;
      padding: 4px;
      transition: all 0.3s;
    }
    .timeline-segment .amount {
      font-size: 13px;
      font-weight: 800;
    }
    .timeline-segment.s-6 { background: var(--danger); }
    .timeline-segment.s-4 { background: var(--warning); }
    .timeline-segment.s-2 { background: var(--info); }
    .timeline-segment.s0 { background: var(--success); }
    .timeline-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 10px;
      color: var(--gray-500);
    }

    /* ========== RESTE DES STYLES ========== */
    .org-card {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      overflow: hidden;
      border: 2px solid transparent;
      transition: all 0.2s;
    }
    .org-card:hover { border-color: var(--primary); box-shadow: var(--shadow-lg); }
    .org-card.highlight { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2); }
    .org-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .org-header.ordinal { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); }
    .org-header.dispositif { background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%); }
    .org-header.obligation { background: linear-gradient(135deg, var(--danger) 0%, #ef4444 100%); }
    .org-header.reseau { background: linear-gradient(135deg, var(--info) 0%, #60a5fa 100%); }
    .org-title { display: flex; align-items: center; gap: 10px; font-size: 15px; font-weight: 700; }
    .org-tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .org-body { padding: 20px; display: none; }
    .org-card.open .org-body { display: block; }

    .info-grid { display: grid; grid-template-columns: 130px 1fr; gap: 12px; }
    @media (max-width: 640px) { .info-grid { grid-template-columns: 1fr; } }
    .info-label { font-size: 11px; font-weight: 700; color: var(--gray-500); text-transform: uppercase; }
    .info-value { font-size: 13px; color: var(--gray-700); }
    .info-value a { color: var(--info); font-weight: 600; text-decoration: none; }
    .info-value a:hover { text-decoration: underline; }
    .info-value ul { margin: 8px 0 0 20px; }
    .info-value li { margin-bottom: 4px; }

    .direct-links {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px dashed var(--gray-200);
    }
    .direct-links h5 {
      font-size: 11px;
      font-weight: 700;
      color: var(--gray-600);
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    .direct-link-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--gray-50);
      border-radius: 8px;
      margin-bottom: 6px;
      font-size: 12px;
      color: var(--gray-700);
      transition: background 0.2s;
    }
    .direct-link-item:hover { background: var(--gray-100); }
    .direct-link-item a { color: var(--info); font-weight: 600; }

    .tag {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      display: inline-block;
    }
    .tag-obligatoire { background: #fef2f2; color: var(--danger); border: 1px solid #fecaca; }
    .tag-recommand√© { background: #fffbeb; color: var(--warning); border: 1px solid #fde68a; }
    .tag-optionnel { background: #eff6ff; color: var(--info); border: 1px solid #bfdbfe; }
    .tag-cac { background: #f3e8ff; color: #7c3aed; border: 1px solid #ddd6fe; }
    .tag-conditionnel { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }

    .search-box {
      position: relative;
      margin-bottom: 16px;
    }
    .search-box input {
      width: 100%;
      padding: 14px 20px 14px 48px;
      border: 2px solid var(--gray-200);
      border-radius: 10px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    .search-box input:focus { outline: none; border-color: var(--primary); }
    .search-box::before {
      content: "üîç";
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
    }

    .category-section { margin-bottom: 24px; }
    .category-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--gray-800);
      padding: 12px 16px;
      background: var(--gray-100);
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .alert {
      padding: 16px 20px;
      border-radius: var(--radius);
      margin-bottom: 16px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .alert-icon { font-size: 20px; flex-shrink: 0; }
    .alert-content { flex: 1; }
    .alert-title { font-weight: 700; margin-bottom: 4px; }
    .alert-danger { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; }
    .alert-warning { background: #fffbeb; border: 1px solid #fde68a; color: #92400e; }
    .alert-info { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }
    .alert-success { background: #ecfdf5; border: 1px solid #bbf7d0; color: #065f46; }

    .insight-box {
      background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
      border-left: 4px solid var(--success);
      padding: 16px 20px;
      border-radius: 0 8px 8px 0;
      margin: 16px 0;
    }
    .insight-box.warning { background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border-left-color: var(--warning); }
    .insight-box.info { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left-color: var(--info); }
    .insight-box.danger { background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-left-color: var(--danger); }
    .insight-box strong { color: var(--gray-800); }

    .checklist-item {
      background: var(--gray-50);
      border-radius: 10px;
      padding: 14px 16px;
      margin-bottom: 10px;
      border-left: 4px solid var(--primary);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      transition: all 0.2s;
    }
    .checklist-item:hover { background: white; box-shadow: var(--shadow); }
    .checklist-item.priorit√©-haute { border-left-color: var(--danger); }
    .checklist-item.priorit√©-moyenne { border-left-color: var(--warning); }
    .checklist-item.priorit√©-basse { border-left-color: var(--success); }
    .checklist-item.checked { background: #ecfdf5; border-left-color: var(--success) !important; }
    .checklist-item.checked .checklist-title { color: var(--success); }
    .checklist-item.checked .checklist-title::after { content: ' ‚úì'; font-weight: 700; color: var(--success); }
    .checklist-checkbox { flex-shrink: 0; margin-top: 2px; }
    .checklist-checkbox input { width: 18px; height: 18px; cursor: pointer; }
    .checklist-content { flex: 1; }
    .checklist-title { font-weight: 600; color: var(--gray-800); font-size: 14px; }
    .checklist-desc { font-size: 12px; color: var(--gray-500); margin-top: 4px; }
    .checklist-link { font-size: 12px; color: var(--info); cursor: pointer; margin-top: 6px; display: inline-block; }
    .checklist-link:hover { text-decoration: underline; }
    .checklist-amount { font-size: 12px; color: var(--primary); font-weight: 700; margin-top: 4px; }

    .timeline { margin: 20px 0; }
    .timeline-item {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px dashed var(--gray-200);
    }
    .timeline-item:last-child { border-bottom: none; }
    .timeline-date {
      flex-shrink: 0;
      width: 80px;
      font-size: 12px;
      font-weight: 700;
      color: var(--primary);
    }
    .timeline-content { flex: 1; }
    .timeline-title { font-weight: 600; color: var(--gray-800); margin-bottom: 4px; }
    .timeline-desc { font-size: 13px; color: var(--gray-600); }

    .disclaimer {
      background: var(--gray-100);
      border: 1px dashed var(--gray-300);
      border-radius: 8px;
      padding: 12px 16px;
      margin-top: 20px;
      font-size: 11px;
      color: var(--gray-600);
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    .disclaimer-icon { font-size: 16px; flex-shrink: 0; }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      padding: 20px;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: white;
      border-radius: var(--radius);
      max-width: 700px;
      width: 100%;
      max-height: 85vh;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      overflow: hidden;
    }
    .modal-header {
      background: var(--primary);
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title { font-weight: 700; font-size: 16px; }
    .modal-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .modal-close:hover { background: rgba(255,255,255,0.3); }
    .modal-body { padding: 20px; overflow-y: auto; max-height: 65vh; }
    .modal-body p { margin-bottom: 12px; color: var(--gray-700); font-size: 14px; }
    .modal-body ul { margin-left: 20px; color: var(--gray-700); font-size: 14px; }
    .modal-body li { margin-bottom: 8px; }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--gray-800);
      color: white;
      padding: 14px 20px;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 9999;
      font-size: 14px;
      font-weight: 500;
    }
    .toast.show { transform: translateY(0); opacity: 1; }

    .progress-container {
      background: var(--gray-200);
      border-radius: 10px;
      height: 8px;
      overflow: hidden;
      margin-top: 8px;
    }
    .progress-bar {
      height: 100%;
      border-radius: 10px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.5s ease;
    }

    .file-input-wrapper { position: relative; overflow: hidden; display: inline-block; }
    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .status-selector {
      background: #fef3c7;
      border: 2px solid #fde68a;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .status-selector-title {
      font-weight: 700;
      color: #92400e;
      font-size: 13px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    @media print {
      body { background: white; }
      .container { padding: 0; max-width: none; }
      .tabs, .action-bar, .toast, .modal-overlay, .search-box { display: none !important; }
      .panel { display: block !important; page-break-inside: avoid; margin-bottom: 30px; }
      .card, .org-card { box-shadow: none; border: 1px solid var(--gray-200); }
      .org-body { display: block !important; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Annexe 5 ‚Äî √âcosyst√®me professionnel du cabinet 100 % num√©rique</h1>
    <p>Carte mentale interactive de l'√©cosyst√®me professionnel pour l'expert-comptable en cr√©ation. Quatre branches th√©matiques (cadre ordinal, d√©veloppement & prospection, obligations, r√©seaux), annuaire d√©taill√© avec liens directs, checklist de d√©marches et calendrier d'√©ch√©ances cl√©s.</p>
    <div class="header-meta">
      <span class="badge">Carte mentale interactive</span>
      <span class="badge">Annuaire interactif</span>
      <span class="badge badge-accent">4 cat√©gories, 16 organismes</span>
    </div>
    <div class="context-box">
      <p><strong>Public cible :</strong> Expert-comptable en cr√©ation ex-nihilo, reprise ou premi√®re inscription au Tableau.</p>
      <p><strong>Objectif :</strong> Visualiser l'√©cosyst√®me professionnel, identifier les interlocuteurs cl√©s et acc√©der directement aux d√©marches administratives. Pour le chiffrage d√©taill√©, se reporter √† l'Annexe 7 (pr√©visionnel financier).</p>
      <p><strong>Mode d'emploi :</strong> Configurez votre statut juridique, naviguez dans la carte mentale, puis utilisez la checklist pour s√©quencer vos d√©marches.</p>
    </div>
  </div>

  <div class="action-bar">
    <button class="btn btn-primary" onclick="loadCasPratique()" style="background: #f59e0b; color: #1f2937;">üìã Cas pratique Cabinet X</button>
    <button class="btn btn-success" onclick="exportJSON()">üíæ Sauvegarder mon dossier</button>
    <div class="file-input-wrapper">
      <button class="btn btn-secondary">üìÇ Charger un dossier</button>
      <input type="file" id="importFile" accept=".json" onchange="importJSON(event)">
    </div>
    <button class="btn btn-primary" onclick="exportPDF()">üìÑ Export PDF</button>
    <button class="btn btn-danger" onclick="resetAll()">üîÑ R√©initialiser</button>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="showPanel('mindmap')">üó∫Ô∏è Carte Mentale</button>
    <button class="tab" onclick="showPanel('checklist')">‚úÖ Checklist</button>
    <button class="tab" onclick="showPanel('annuaire')">üìñ Annuaire</button>
    <button class="tab" onclick="showPanel('calendrier')">üìÖ Calendrier</button>
  </div>

  <!-- ==================== PANEL 1: CARTE MENTALE ==================== -->
  <div id="mindmap" class="panel active">
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üó∫Ô∏è</div>
        <div>
          <h3>Carte Mentale de l'√©cosyst√®me professionnel</h3>
          <div class="subtitle">Cliquez sur un noeud pour acceder a sa fiche complete dans l'annuaire</div>
        </div>
      </div>

      <!-- SELECTEUR STATUT JURIDIQUE -->
      <div class="status-selector">
        <div class="status-selector-title">‚ö†Ô∏è Configuration importante : Statut juridique du cabinet</div>
        <div class="profil-grid" style="margin: 0;">
          <div class="profil-field">
            <label>Forme juridique</label>
            <select id="formeJuridique" onchange="updateStatutSocial(); renderAll();">
              <option value="liberal">Exercice liberal (BNC)</option>
              <option value="sarl">SARL / EURL (g√©rant majoritaire)</option>
              <option value="sas">SAS / SASU (president)</option>
              <option value="selarl">SELARL (g√©rant majoritaire)</option>
              <option value="selas">SELAS (president)</option>
            </select>
          </div>
          <div class="profil-field">
            <label>Statut social du dirigeant</label>
            <input type="text" id="statutSocial" value="TNS - Travailleur Non Salarie" disabled style="background: #f0fdf4; color: #065f46; font-weight: 600;">
          </div>
        </div>
        <div style="margin-top: 10px; font-size: 12px; color: #92400e;">
          <strong>Impact :</strong> <span id="impactStatut">Affiliation URSSAF en tant que TNS + CAVEC obligatoire</span>
        </div>
      </div>

      <div class="profil-grid">
        <div class="profil-field">
          <label>Phase du projet</label>
          <select id="situation" onchange="renderAll()">
            <option value="creation">Cr√©ation (S-6 √† J+90)</option>
            <option value="installation">Premi√®re ann√©e d'exercice</option>
            <option value="exercice">Cabinet en activit√©</option>
            <option value="evolution">Evolution / Diversification</option>
          </select>
        </div>
        <div class="profil-field">
          <label>Priorit√© actuelle</label>
          <select id="priorit√©" onchange="renderAll()">
            <option value="conformit√©">Conformit√© reglementaire</option>
            <option value="dev">D√©veloppement commercial</option>
            <option value="reseau">R√©seau professionnel</option>
            <option value="comp√©tences">Montee en comp√©tences</option>
          </select>
        </div>
        <div class="profil-field">
          <label>Region d'exercice</label>
          <input type="text" id="region" placeholder="Ex : √éle-de-France" onchange="renderAll()">
        </div>
        <div class="profil-field">
          <label>Projet CAC</label>
          <select id="projetCAC" onchange="renderAll()">
            <option value="non">Non</option>
            <option value="oui">Oui, a terme</option>
          </select>
        </div>
      </div>

      <!-- CARTE MENTALE AGRANDIE -->
      <div class="mindmap-wrapper">
        <div class="mindmap-grid">
          
          <!-- HAUT : Cadre Ordinal -->
          <div class="mindmap-branch top">
            <div style="width: 100%; text-align: center; margin-bottom: 6px;">
              <span class="mindmap-cat-label ordinal">A. Cadre Ordinal</span>
            </div>
            <div class="mindmap-nodes-row">
              <div class="mindmap-node ordinal" onclick="focusOrg('oec')">
                <div class="mindmap-node-icon">üèõÔ∏è</div>
                <div class="mindmap-node-text">OEC / CROEC</div>
                <div class="mindmap-node-tag obligatoire">Obligatoire</div>
              </div>
              <div class="mindmap-node ordinal" onclick="focusOrg('h2a')">
                <div class="mindmap-node-icon">‚öñÔ∏è</div>
                <div class="mindmap-node-text">H2A (ex-H3C)</div>
                <div class="mindmap-node-tag cac">Si activit√© CAC</div>
              </div>
              <div class="mindmap-node ordinal" onclick="focusOrg('cjec')">
                <div class="mindmap-node-icon">üë•</div>
                <div class="mindmap-node-text">CJEC</div>
                <div class="mindmap-node-tag recommand√©">Recommand√©</div>
              </div>
              <div class="mindmap-node ordinal" onclick="focusOrg('ifec')">
                <div class="mindmap-node-icon">üé§</div>
                <div class="mindmap-node-text">IFEC / ECF</div>
                <div class="mindmap-node-tag optionnel">Optionnel</div>
              </div>
            </div>
          </div>

          <!-- GAUCHE : D√©veloppement &amp; prospection -->
          <div class="mindmap-branch left">
            <span class="mindmap-cat-label dispositif">B. D√©veloppement &amp; prospection</span>
            <div class="mindmap-node dispositif" onclick="focusOrg('businessstory')">
              <div class="mindmap-node-icon">üöÄ</div>
              <div class="mindmap-node-text">Business Story</div>
              <div class="mindmap-node-tag gratuit">Prospection (gratuit)</div>
            </div>
            <div class="mindmap-node dispositif" onclick="focusOrg('francenum')">
              <div class="mindmap-node-icon">üíª</div>
              <div class="mindmap-node-text">France Num</div>
              <div class="mindmap-node-tag optionnel">Positionnement (gratuit)</div>
            </div>
          </div>

          <!-- CENTRE : Expert-Comptable -->
          <div class="mindmap-center-zone">
            <div class="mindmap-center" onclick="openModal('Expert-Comptable', getMindmapCenterContent())">
              <div class="mindmap-center-icon">üë§</div>
              <div class="mindmap-center-text">EXPERT-<br>COMPTABLE</div>
              <div class="mindmap-center-sub">En cr√©ation</div>
            </div>
          </div>

          <!-- DROITE : Obligations -->
          <div class="mindmap-branch right">
            <span class="mindmap-cat-label obligation">C. Obligations</span>
            <div class="mindmap-node obligation" onclick="focusOrg('guichet-unique')">
              <div class="mindmap-node-icon">üìù</div>
              <div class="mindmap-node-text">Guichet Unique INPI</div>
              <div class="mindmap-node-tag obligatoire">Obligatoire</div>
            </div>
            <div class="mindmap-node obligation" onclick="focusOrg('rcp')">
              <div class="mindmap-node-icon">üõ°Ô∏è</div>
              <div class="mindmap-node-text">Assurance RCP</div>
              <div class="mindmap-node-tag obligatoire">Obligatoire</div>
            </div>
            <div class="mindmap-node obligation" onclick="focusOrg('cavec')">
              <div class="mindmap-node-icon">üè¶</div>
              <div class="mindmap-node-text">CAVEC</div>
              <div class="mindmap-node-tag obligatoire">Obligatoire</div>
            </div>
            <div class="mindmap-node obligation" id="node-urssaf" onclick="focusOrg('urssaf')">
              <div class="mindmap-node-icon">üìã</div>
              <div class="mindmap-node-text">URSSAF TNS</div>
              <div class="mindmap-node-tag conditionnel">Si gerant TNS</div>
            </div>
            <div class="mindmap-node obligation" onclick="focusOrg('dgfip')">
              <div class="mindmap-node-icon">üè¢</div>
              <div class="mindmap-node-text">DGFIP</div>
              <div class="mindmap-node-tag obligatoire">Obligatoire</div>
            </div>
          </div>

          <!-- BAS : R√©seaux -->
          <div class="mindmap-branch bottom">
            <div style="width: 100%; text-align: center; margin-bottom: 6px;">
              <span class="mindmap-cat-label reseau">D. R√©seaux</span>
            </div>
            <div class="mindmap-nodes-row">
              <div class="mindmap-node reseau" onclick="focusOrg('dfcg')">
                <div class="mindmap-node-icon">üìä</div>
                <div class="mindmap-node-text">DFCG</div>
                <div class="mindmap-node-tag optionnel">Optionnel</div>
              </div>
              <div class="mindmap-node reseau" onclick="focusOrg('reseauentreprendre')">
                <div class="mindmap-node-icon">üå±</div>
                <div class="mindmap-node-text">Reseau Entreprendre</div>
                <div class="mindmap-node-tag optionnel">Optionnel</div>
              </div>
              <div class="mindmap-node reseau" onclick="focusOrg('cjd')">
                <div class="mindmap-node-icon">ü§ù</div>
                <div class="mindmap-node-text">CJD</div>
                <div class="mindmap-node-tag optionnel">Optionnel</div>
              </div>
              <div class="mindmap-node reseau" onclick="focusOrg('cci')">
                <div class="mindmap-node-icon">üè™</div>
                <div class="mindmap-node-text">CCI</div>
                <div class="mindmap-node-tag optionnel">Optionnel</div>
              </div>
              <div class="mindmap-node reseau" onclick="focusOrg('bni')">
                <div class="mindmap-node-icon">üîó</div>
                <div class="mindmap-node-text">BNI</div>
                <div class="mindmap-node-tag optionnel">Optionnel</div>
              </div>
            </div>
          </div>

        </div>

        <!-- Legende -->
        <div class="mindmap-legend">
          <div class="mindmap-legend-item">
            <div class="mindmap-legend-dot" style="background: var(--primary);"></div>
            <span>Cadre ordinal</span>
          </div>
          <div class="mindmap-legend-item">
            <div class="mindmap-legend-dot" style="background: var(--secondary);"></div>
            <span>D√©veloppement &amp; prospection</span>
          </div>
          <div class="mindmap-legend-item">
            <div class="mindmap-legend-dot" style="background: var(--danger);"></div>
            <span>Obligations</span>
          </div>
          <div class="mindmap-legend-item">
            <div class="mindmap-legend-dot" style="background: var(--info);"></div>
            <span>R√©seaux</span>
          </div>
          <div class="mindmap-legend-item">
            <div class="mindmap-legend-dot" style="background: #92400e;"></div>
            <span>Conditionnel (selon statut)</span>
          </div>
          <div class="mindmap-legend-item">
            <div class="mindmap-legend-dot" style="background: #059669;"></div>
            <span>Gratuit</span>
          </div>
        </div>
      </div>

      <div id="recommandationsBox"></div>
    </div>
  </div>

  <!-- ==================== PANEL 3: CHECKLIST ==================== -->
  <div id="checklist" class="panel">
    <div class="card">
      <div class="card-header">
        <div class="card-icon danger">‚úÖ</div>
        <div>
          <h3>Checklist guidee d'installation</h3>
          <div class="subtitle">Cochez au fur et √† mesure de vos d√©marches d'installation</div>
        </div>
      </div>

      <div class="alert alert-success">
        <div class="alert-icon">üîÑ</div>
        <div class="alert-content">
          <div class="alert-title">Mise √† jour automatique</div>
          <div>Cette checklist s'adapte automatiquement en fonction de votre statut juridique. Les montants affiches sont indicatifs et doivent etre verifies aupres des organismes concernes.</div>
        </div>
      </div>

      <div class="grid-4" style="margin-bottom: 20px;">
        <div class="stat-card">
          <div class="stat-value" id="statObligatoires">6</div>
          <div class="stat-label">Obligations</div>
          <div class="stat-trend down">Prioritaires</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statRecommand√©s">2</div>
          <div class="stat-label">Recommand√©s</div>
          <div class="stat-trend up">A considerer</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statOptionnels">5</div>
          <div class="stat-label">Optionnels</div>
          <div class="stat-trend neutral">Selon strategie</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statProgression">0%</div>
          <div class="stat-label">Progression</div>
          <div class="progress-container"><div class="progress-bar" id="progressBar" style="width: 0%;"></div></div>
        </div>
      </div>

      <div id="checklistContainer"></div>
    </div>
  </div>

  <!-- ==================== PANEL 4: ANNUAIRE ==================== -->
  <div id="annuaire" class="panel">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Rechercher un organisme, mot-cle..." onkeyup="filterOrganismes()">
    </div>
    <div id="annuaireContainer"></div>
  </div>

  <!-- ==================== PANEL 5: CALENDRIER ==================== -->
  <div id="calendrier" class="panel">
    <div class="card">
      <div class="card-header">
        <div class="card-icon accent">üìÖ</div>
        <div>
          <h3>Calendrier des √©ch√©ances cl√©s</h3>
          <div class="subtitle">Dates importantes pour l'expert-comptable en cr√©ation</div>
        </div>
      </div>

      <div class="alert alert-info">
        <div class="alert-icon">üìù</div>
        <div class="alert-content">
          <div class="alert-title">Guichet Unique INPI : 100 % op√©rationnel</div>
          <div>Depuis le 1er janvier 2023, toutes les formalites passent par le Guichet Unique INPI (formalites.entreprises.gouv.fr). L'ancienne proc√©dure de continuit√© Infogreffe a expire au 31/12/2024. Les formulaires P0PL et M0 sont obsol√®tes.</div>
        </div>
      </div>

      <div class="alert alert-warning">
        <div class="alert-icon">‚ö†Ô∏è</div>
        <div class="alert-content">
          <div class="alert-title">Facturation √©lectronique : √©ch√©ances 2026-2027</div>
          <div>La reforme entre en vigueur progressivement (art. 91 LF 2024). Anticipez le choix de votre PA (ex-PDP).</div>
        </div>
      </div>

      <div class="timeline">
        <div class="timeline-item">
          <div class="timeline-date">S-6</div>
          <div class="timeline-content">
            <div class="timeline-title">Formalit√©s de cr√©ation (Guichet Unique INPI)</div>
            <div class="timeline-desc">Declaration unique via formalites.entreprises.gouv.fr. Remplace les anciens formulaires P0PL et M0 depuis 2023.</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">S-6</div>
          <div class="timeline-content">
            <div class="timeline-title">Preparation du dossier d'inscription CROEC</div>
            <div class="timeline-desc">Via Espace Pro Comptexpert. Documents : diplome DEC, RCP, Kbis, statuts. Depot 14 jours avant Commission du Tableau.</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">S-4</div>
          <div class="timeline-content">
            <div class="timeline-title">Souscription assurance RCP</div>
            <div class="timeline-desc">Obligatoire avant tout demarrage. Decret n¬∞2025-483 du 30 mai 2025 : couverture de tous les associ√©s exer√ßants (entr√©e en vigueur : 1er juillet 2025).</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">S-2</div>
          <div class="timeline-content">
            <div class="timeline-title">Affiliation CAVEC + declaration URSSAF (si TNS)</div>
            <div class="timeline-desc">Inscription au regime de retraite obligatoire. URSSAF uniquement si g√©rant majoritaire SARL/SELARL (statut TNS).</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">S0</div>
          <div class="timeline-content">
            <div class="timeline-title">Inscription effective au Tableau</div>
            <div class="timeline-desc">D√©but officiel de l'activit√©. Vous pouvez exercer et signer des missions.</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">S0+</div>
          <div class="timeline-content">
            <div class="timeline-title">Activation d√©veloppement</div>
            <div class="timeline-desc">Business Story (prospection gratuit√©), CJEC, 1 reseau (1 maximum au debut pour ne pas se disperser).</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">Sept. 2026</div>
          <div class="timeline-content">
            <div class="timeline-title">Facturation √©lectronique : reception obligatoire</div>
            <div class="timeline-desc">Toutes les entreprises doivent recevoir des factures √©lectroniques + emission pour GE/ETI.</div>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-date">Sept. 2027</div>
          <div class="timeline-content">
            <div class="timeline-title">Facturation √©lectronique : emission PME/TPE</div>
            <div class="timeline-desc">Obligation d'emettre pour les PME, TPE et micro-entreprises.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Information</div>
      <button class="modal-close" onclick="closeModal()">Fermer</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const STORAGE_KEY = "annexe5_carte_mentale_v6_final";

const organismes = [
  // A. CADRE ORDINAL
  {
    id: "oec", nom: "Ordre des experts-comptables (OEC / CROEC)", categorie: "ordinal", tags: ["obligatoire"],
    keywords: "ordre oec croec inscription tableau d√©ontologie comptexpert",
    role: "Inscription au Tableau via le Conseil regional, d√©ontologie, contr√¥le qualit√©, accompagnement.",
    quand: ["Cr√©ation / inscription au Tableau", "Questions d√©ontologiques", "Contr√¥le qualit√©", "Formation continue"],
    site: "https://www.experts-comptables.fr", siteLabel: "experts-comptables.fr",
    contact: "Votre CROEC regional (16 conseils en metropole)",
    note: "Depuis le 1er janvier 2023, le Guichet Unique INPI remplace les formulaires P0PL et M0. L'inscription √† l'Ordre se fait via l'Espace Pro Comptexpert. D√©lai moyen : 6-8 semaines apr√®s d√©p√¥t du dossier complet.",
    directLinks: [
      { label: "Guichet Unique INPI (creation entreprise)", url: "https://formalites.entreprises.gouv.fr/" },
      { label: "Espace Pro Comptexpert (inscription Ordre)", url: "https://espace-pro.oec-paris.fr/inscriptions-ordinales" },
      { label: "Annuaire CROEC", url: "https://www.experts-comptables.fr/l-institution/notre-presence-en-region" }
    ]
  },
  {
    id: "h2a", nom: "H2A - Haute Autorit√© de l'Audit (ex-H3C)", categorie: "ordinal", tags: ["cac"],
    keywords: "h2a h3c commissariat comptes cac supervision audit",
    role: "Supervision du commissariat aux comptes et des auditeurs de durabilite (depuis 01/01/2024).",
    quand: ["Projet d'activit√© CAC", "Inscription liste CAC", "Questions supervision"],
    site: "https://h2a-france.org", siteLabel: "h2a-france.org",
    contact: "Formulaire de contact via le site",
    note: "Remplace le H3C depuis le 1er janvier 2024 (ordonnance n¬∞2023-1142 du 6 decembre 2023).",
    directLinks: [
      { label: "Site officiel H2A", url: "https://h2a-france.org" }
    ]
  },
  {
    id: "cjec", nom: "CJEC - Club des Jeunes Experts-Comptables", categorie: "ordinal", tags: ["recommand√©"],
    keywords: "cjec installation jeune dipl√¥m√© r√©seau",
    role: "Accompagnement √† l'installation, √©changes entre pairs, √©v√©nements d√©di√©s.",
    quand: ["Installation / 1√®re ann√©e", "√âchanges entre pairs", "√âv√©nements (Welcome Party)"],
    site: "https://cjec.anecs-cjec.org", siteLabel: "cjec.anecs-cjec.org",
    contact: "anecs-cjec@anecs-cjec.org",
    note: "Cotisation annuelle : environ 150 ‚Ç¨. Journ√©e des Jeunes Inscrits chaque ann√©e.",
    directLinks: [{ label: "Adh√©sion CJEC", url: "https://cjec.anecs-cjec.org" }]
  },
  {
    id: "ifec", nom: "IFEC / ECF - Syndicats professionnels", categorie: "ordinal", tags: ["optionnel"],
    keywords: "ifec ecf syndicat representation",
    role: "Representation, defense des interets de la profession.",
    quand: ["Representation professionnelle", "Ressources syndicales"],
    site: "https://ifec.fr", siteLabel: "ifec.fr / e-c-f.fr",
    contact: "Sections regionales sur les sites",
    note: "Cotisation annuelle variable selon CA.",
    directLinks: [
      { label: "Site IFEC", url: "https://ifec.fr" },
      { label: "Site ECF", url: "https://e-c-f.fr" }
    ]
  },
  // B. DEVELOPPEMENT & PROSPECTION
  {
    id: "businessstory", nom: "Business Story - Levier de prospection OEC", categorie: "dispositif", tags: ["recommand√©"],
    keywords: "business story prospection porteurs projets clients gratuit",
    role: "Canal d'acquisition clients : l'EC s'inscrit comme volontaire et offre 3 RDV gratuits a des porteurs de projets (createurs, repreneurs). Objectif : convertir ces prospects en clients du cabinet. Le dispositif est pilote par le CSOEC depuis 2016 et repose sur la plateforme business-story.biz.",
    quand: ["D√®s l'inscription au Tableau (S0+)", "Prospection premiers clients", "D√©veloppement portefeuille"],
    site: "https://www.business-story.biz", siteLabel: "business-story.biz",
    contact: "Inscription via Network Experts-comptables (Comptexpert) ou CROEC",
    note: "GRATUIT pour l'EC volontaire. L'EC n'est pas le b√©n√©ficiaire mais le prestataire : il propose 3 RDV aux porteurs de projets. C'est un investissement commercial, pas un accompagnement √† la cr√©ation du cabinet. Lettre de mission obligatoire d√®s le 1er RDV.",
    directLinks: [
      { label: "Plateforme Business Story", url: "https://www.business-story.biz" },
      { label: "Page officielle Ordre", url: "https://www.experts-comptables.fr/business-story" },
      { label: "FAQ Business Story (CNOEC)", url: "https://www.experts-comptables.fr/faq-business-story" }
    ]
  },
  {
    id: "francenum", nom: "France Num - Positionnement conseil numerique", categorie: "dispositif", tags: ["optionnel"],
    keywords: "france num numerique tpe pme activateur gouvernement dge positionnement",
    role: "Initiative gouvernementale (DGE / Ministere de l'Economie). L'EC peut devenir 'Activateur France Num' : il apparait dans l'annuaire national des experts du numerique et renforce son positionnement de conseil en transformation digitale aupres des TPE/PME.",
    quand: ["Positionnement conseil numerique", "Devenir Activateur (des S0+)", "Credibilite aupres des TPE/PME"],
    site: "https://www.francenum.gouv.fr", siteLabel: "francenum.gouv.fr",
    contact: "Formulaire sur le site",
    note: "Devenir Activateur France Num est gratuit et renforce le positionnement du cabinet sur l'accompagnement numerique. L'EC n'est pas accompagne : il devient lui-meme accompagnateur pour ses clients.",
    directLinks: [{ label: "Devenir Activateur", url: "https://www.francenum.gouv.fr/experts-du-numerique/trouver-un-expert-du-numerique" }]
  },
  // C. OBLIGATIONS
  {
    id: "guichet-unique", nom: "Guichet Unique INPI - Formalites d'entreprises", categorie: "obligation", tags: ["obligatoire"],
    keywords: "guichet unique inpi formalit√©s cr√©ation entreprise siret rcs p0pl m0",
    role: "Plateforme unique pour toutes les formalit√©s de cr√©ation, modification et cessation d'entreprise. Remplace les anciens formulaires CERFA (P0PL, M0) depuis le 1er janvier 2023.",
    quand: ["Cr√©ation de structure (SARL, SAS, SELARL, SELAS)", "D√©claration d√©but activit√© lib√©rale", "Obtention num√©ro SIRET", "Modifications statutaires"],
    site: "https://formalites.entreprises.gouv.fr", siteLabel: "formalites.entreprises.gouv.fr",
    contact: "Assistance INPI : 01 56 65 89 98 - Code profession EC : 3046931",
    note: "Op√©rationnel √† 100 % depuis le 1er janvier 2025. La proc√©dure de continuit√© Infogreffe (arr√™t√© du 26 d√©cembre 2023) a expir√© le 31 d√©cembre 2024. Pr√®s de 4 millions de formalit√©s trait√©es en 2024 (source : INPI).",
    directLinks: [
      { label: "Acceder au Guichet Unique", url: "https://formalites.entreprises.gouv.fr/" },
      { label: "Guide utilisateur INPI", url: "https://www.inpi.fr/formalites-entreprises" },
      { label: "FAQ Guichet Unique", url: "https://formalites.entreprises.gouv.fr/aide" }
    ]
  },
  {
    id: "rcp", nom: "Assurance RCP", categorie: "obligation", tags: ["obligatoire"],
    keywords: "assurance rcp responsabilit√© civile obligatoire",
    role: "Couvre la responsabilit√© professionnelle. Obligation fondee sur l'article 17 de l'ordonnance n¬∞45-2138 du 19 septembre 1945, renforcee par le d√©cret n¬∞2025-483 du 30 mai 2025.",
    quand: ["Avant tout demarrage", "Renouvellement annuel"],
    site: "", siteLabel: "",
    contact: "MACSF, AXA Pro, MMA Pro, Allianz",
    note: "Fondement historique : art. 17, ordonnance 19 sept. 1945. Renforcement : d√©cret n¬∞2025-483 du 30 mai 2025 (couverture de tous les associ√©s exer√ßants, entr√©e en vigueur 1er juillet 2025). V√©rifier les garanties cyber dans le contrat (incident Coaxis, dec. 2023).",
    directLinks: [
      { label: "MACSF", url: "https://www.macsf.fr" },
      { label: "AXA Professionnels", url: "https://www.axa.fr/professionnel.html" },
      { label: "MMA Professionnels", url: "https://www.mma.fr/assurance-professionnels.html" }
    ]
  },
  {
    id: "cavec", nom: "CAVEC - Retraite & prevoyance", categorie: "obligation", tags: ["obligatoire"],
    keywords: "cavec retraite prevoyance cotisations",
    role: "Regime de retraite obligatoire des EC (base + complementaire + prevoyance).",
    quand: ["Affiliation obligatoire", "Declaration annuelle", "Choix classe cotisation"],
    site: "https://www.cavec.fr", siteLabel: "cavec.fr",
    contact: "Espace assure CAVEC",
    note: "Baremes 2026 (source CAVEC, 21 janvier 2026). TNS : Classe A = 898 ‚Ç¨, Classe D = 8 282 ‚Ç¨, prevoyance classe 1 = 288 ‚Ç¨, retraite base CNAVPL = 573 ‚Ç¨ min. Salaries/assimiles-salaries : complementaire classe C minimum (5 554 ‚Ç¨), pas de retraite base CNAVPL ni prevoyance CAVEC.",
    directLinks: [
      { label: "Cotisations officielles 2026", url: "https://www.cavec.fr/vous-etes-liberal-tns/vos-cotisations/montant-de-vos-cotisations/vos-cotisations-retraite-prevoyance-et-options/" },
      { label: "Cotisations salaries / assimiles-salaries", url: "https://www.cavec.fr/vous-etes-salarie-employeur/vos-cotisations/" },
      { label: "Espace assure", url: "https://www.cavec.fr" }
    ]
  },
  {
    id: "urssaf", nom: "URSSAF - Cotisations sociales TNS", categorie: "obligation", tags: ["conditionnel"],
    keywords: "urssaf cotisations sociales declaration tns",
    role: "Declaration et paiement des cotisations sociales pour les TNS (g√©rant majoritaire SARL/SELARL).",
    quand: ["D√©claration d'activit√© (si TNS)", "Declarations periodiques", "Regularisation annuelle"],
    site: "https://www.urssaf.fr", siteLabel: "urssaf.fr",
    contact: "Espace en ligne / messagerie URSSAF",
    note: "ATTENTION : Concerne uniquement les TNS (g√©rant majoritaire SARL, EURL, SELARL). Les presidents de SAS/SELAS sont assimiles-salaries (regime g√©n√©ral via DSN). Reforme assiette 2025 (LFSS 2024, art. 18) ‚Äî application effective en 2026 lors de la regularisation.",
    directLinks: [{ label: "Espace personnel", url: "https://www.urssaf.fr/accueil/services-en-ligne.html" }]
  },
  {
    id: "dgfip", nom: "DGFIP - Administration fiscale", categorie: "obligation", tags: ["obligatoire"],
    keywords: "dgfip impots fiscal tva is",
    role: "TVA, IS/IR, obligations declaratives du cabinet.",
    quand: ["Declarations fiscales", "TVA", "IS/IR annuel"],
    site: "https://www.impots.gouv.fr", siteLabel: "impots.gouv.fr",
    contact: "Messagerie securisee (espace pro)",
    note: "Creer l'espace professionnel d√®s le demarrage.",
    directLinks: [{ label: "Espace professionnel", url: "https://www.impots.gouv.fr/professionnel" }]
  },
  // D. RESEAUX
  {
    id: "dfcg", nom: "DFCG - Directeurs Financiers", categorie: "r√©seau", tags: ["optionnel"],
    keywords: "dfcg daf finance controleur gestion",
    role: "1er r√©seau des directions financi√®res. √âv√©nements, formations.",
    quand: ["Positionnement DAF externalise", "Communaute finance"],
    site: "https://www.dfcg.fr", siteLabel: "dfcg.fr",
    contact: "Adh√©sion sur le site",
    note: "Cotisation annuelle variable selon profil : ~217 ‚Ç¨ HT (nouvel adh√©rent) a ~350 ‚Ç¨ HT (plein tarif). 1er r√©seau des dirigeants financiers, 3 000+ membres.",
    directLinks: [{ label: "Adh√©sion DFCG", url: "https://www.dfcg.fr/pourquoi-adherer/" }]
  },
  {
    id: "reseauentreprendre", nom: "R√©seau Entreprendre", categorie: "r√©seau", tags: ["optionnel"],
    keywords: "r√©seau entreprendre mentoring dirigeants",
    role: "R√©seau de chefs d'entreprise, accompagnement, pr√™ts d'honneur.",
    quand: ["Visibilit√© entrepreneurs", "Recommandations", "Accompagnateur benevole"],
    site: "https://www.reseau-entreprendre.org", siteLabel: "reseau-entreprendre.org",
    contact: "Associations locales sur le site",
    note: "14 000+ entrepreneurs. Possibilit√© de devenir accompagnateur.",
    directLinks: [{ label: "Devenir accompagnateur", url: "https://www.reseau-entreprendre.org/fr/entreprendre/" }]
  },
  {
    id: "cjd", nom: "CJD - Centre Jeunes Dirigeants", categorie: "r√©seau", tags: ["optionnel"],
    keywords: "cjd dirigeants club r√©seau",
    role: "Mouvement de dirigeants engag√©s. R√©seau, r√©flexion, √©v√©nements.",
    quand: ["Acces a des dirigeants", "Recommandations", "Reflexion dirigeant"],
    site: "https://www.cjd.net", siteLabel: "cjd.net",
    contact: "cjd@cjd.net - 01 53 23 92 50",
    note: "6 000+ membres. Cotisation annuelle variable selon section (non publiee, se renseigner aupres de la section locale). Processus de candidature.",
    directLinks: [{ label: "Devenir membre", url: "https://www.cjd.net/nous-rejoindre/devenir-membre/" }]
  },
  {
    id: "cci", nom: "CCI - Chambres de Commerce", categorie: "r√©seau", tags: ["optionnel"],
    keywords: "cci chambre commerce industrie",
    role: "Animation economique locale, clubs sectoriels, √©v√©nements.",
    quand: ["Ancrage territorial", "Clubs sectoriels", "√âv√©nements locaux"],
    site: "https://www.cci.fr", siteLabel: "cci.fr",
    contact: "CCI locale",
    note: "Bon point d'entree pour ancrage local.",
    directLinks: [{ label: "Trouver ma CCI", url: "https://www.cci.fr" }]
  },
  {
    id: "bni", nom: "BNI - Business Network International", categorie: "r√©seau", tags: ["optionnel"],
    keywords: "bni recommandations chapitres",
    role: "R√©seau structur√© de recommandations. 19 000+ membres en France (source : BNI France, 2025).",
    quand: ["D√©veloppement par recommandation", "Visibilit√© locale", "R√©unions hebdo"],
    site: "https://bnifrance.fr", siteLabel: "bnifrance.fr",
    contact: "Trouver un chapitre sur le site",
    note: "Cotisation annuelle : ~1 500 ‚Ç¨ HT (source : bnifrance.fr, 2025) + droit d'entr√©e 500 ‚Ç¨ HT (1√®re ann√©e uniquement). Frais de petits-d√©jeuners hebdomadaires : 10-20 ‚Ç¨ √ó ~45 r√©unions/an = 450-900 ‚Ç¨ HT suppl√©mentaires. Budget total ann√©e 1 : ~2 500-2 900 ‚Ç¨ HT tout compris.",
    directLinks: [{ label: "Trouver un chapitre", url: "https://bnifrance.fr" }]
  }
];

let checklistState = {};

function initState() {
  organismes.forEach(org => { checklistState[org.id] = false; });
  checklistState['guichet-unique'] = false;
  checklistState['cavec-base'] = false;
  checklistState['cavec-prev'] = false;
  checklistState['cotisation'] = false;
}
initState();

function showPanel(panelId) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById(panelId).classList.add('active');
  document.querySelectorAll('.tab').forEach(t => {
    t.classList.remove('active');
    if (t.getAttribute('onclick')?.includes(panelId)) t.classList.add('active');
  });
  if (panelId === 'annuaire') renderAnnuaire();
  if (panelId === 'checklist') renderChecklist();
}

function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2500);
}

function openModal(title, body) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').innerHTML = body;
  document.getElementById('modalOverlay').classList.add('show');
}

function closeModal(e) {
  if (e && e.target.id !== 'modalOverlay') return;
  document.getElementById('modalOverlay').classList.remove('show');
}

function getMindmapCenterContent() {
  const forme = document.getElementById('formeJuridique').value;
  let statutText = 'TNS - Travailleur Non Salarie';
  if (forme === 'sas' || forme === 'selas') {
    statutText = 'Assimile-salarie (regime g√©n√©ral)';
  }
  return `
    <p>L'expert-comptable en phase de cr√©ation se trouve au centre d'un √©cosyst√®me professionnel structur√© en 4 axes :</p>
    <ul>
      <li><strong>Cadre ordinal</strong> : instances qui structurent et repr√©sent√©nt la profession</li>
      <li><strong>D√©veloppement &amp; prospection</strong> : leviers d'acquisition clients et de positionnement activables par l'EC</li>
      <li><strong>Obligations</strong> : pre-requis legaux et r√©glementaires incontournables</li>
      <li><strong>R√©seaux</strong> : leviers de d√©veloppement commercial et de visibilit√©</li>
    </ul>
    <p style="margin-top: 16px;"><strong>Votre statut actuel :</strong> ${statutText}</p>
    <p style="margin-top: 12px;"><strong>Conseil :</strong> Priorisez d'abord les obligations (rouge), puis activez 1-2 dispositifs/r√©seaux maximum la premi√®re ann√©e.</p>
  `;
}

function updateStatutSocial() {
  const forme = document.getElementById('formeJuridique').value;
  const statutInput = document.getElementById('statutSocial');
  const impactSpan = document.getElementById('impactStatut');
  const nodeUrssaf = document.getElementById('node-urssaf');
  
  if (forme === 'sas' || forme === 'selas') {
    statutInput.value = 'Assimile-salarie (regime g√©n√©ral)';
    statutInput.style.background = '#eff6ff';
    statutInput.style.color = '#1e40af';
    impactSpan.textContent = 'Cotisations via DSN (comme un salarie cadre). Pas d\'URSSAF TNS. CAVEC complementaire obligatoire (classe C minimum). Pas de retraite base CNAVPL ni prevoyance CAVEC.';
    if (nodeUrssaf) {
      nodeUrssaf.style.opacity = '0.4';
      nodeUrssaf.querySelector('.mindmap-node-tag').textContent = 'Non applicable';
    }
  } else {
    statutInput.value = 'TNS - Travailleur Non Salarie';
    statutInput.style.background = '#f0fdf4';
    statutInput.style.color = '#065f46';
    impactSpan.textContent = 'Affiliation URSSAF en tant que TNS + CAVEC obligatoire (base + complementaire + prevoyance). Reforme assiette 2025 (LFSS 2024, application 2026).';
    if (nodeUrssaf) {
      nodeUrssaf.style.opacity = '1';
      nodeUrssaf.querySelector('.mindmap-node-tag').textContent = 'Si gerant TNS';
    }
  }
}

function focusOrg(id) {
  showPanel('annuaire');
  setTimeout(() => {
    const el = document.getElementById('org-' + id);
    if (el) {
      el.classList.add('highlight');
      el.classList.add('open');
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      setTimeout(() => el.classList.remove('highlight'), 3000);
    }
  }, 100);
}

function toggleOrg(id) {
  const el = document.getElementById('org-' + id);
  if (el) el.classList.toggle('open');
}

function renderAll() {
  renderRecommandations();
  renderChecklist();
  renderAnnuaire();
  updateStats();
}

function updateStats() {
  const totalItems = document.querySelectorAll('#checklistContainer .checklist-checkbox input');
  const checkedItems = document.querySelectorAll('#checklistContainer .checklist-checkbox input:checked');
  const total = totalItems.length || 1;
  const checked = checkedItems.length;
  const pct = Math.round((checked / total) * 100);
  document.getElementById('statProgression').textContent = pct + '%';
  document.getElementById('progressBar').style.width = pct + '%';
}



function renderRecommandations() {
  const container = document.getElementById('recommandationsBox');
  const situation = document.getElementById('situation').value;
  const forme = document.getElementById('formeJuridique').value;
  const isTNS = (forme !== 'sas' && forme !== 'selas');
  
  let html = '';
  
  if (situation === 'creation') {
    html += '<div class="insight-box danger"><strong>Priorit√© cr√©ation (S-6 √† J+90)</strong><br>1. Guichet Unique INPI - 2. Inscription CROEC - 3. Assurance RCP - 4. CAVEC';
    if (isTNS) html += ' + URSSAF TNS';
    html += ' - 5. Un seul reseau au demarrage.</div>';
  } else if (situation === 'installation') {
    html += '<div class="insight-box warning"><strong>Priorit√© 1ere annee</strong><br>Rejoindre le CJEC, activer Business Story (gratuit), structurer la prospection.</div>';
  } else if (situation === 'exercice') {
    html += '<div class="insight-box"><strong>Cabinet en exercice</strong><br>Renforcer les reseaux de recommandation, evaluer les syndicats.</div>';
  } else if (situation === 'evolution') {
    html += '<div class="insight-box info"><strong>Evolution / diversification</strong><br>Si projet CAC : H2A. Conseil : DFCG. Innovation : Bpifrance.</div>';
  }
  
  container.innerHTML = html;
}

function renderChecklist() {
  const container = document.getElementById('checklistContainer');
  const forme = document.getElementById('formeJuridique').value;
  const isTNS = (forme !== 'sas' && forme !== 'selas');
  
  const items = [
    { id: 'guichet-unique', titre: 'Formalit√©s via Guichet Unique INPI', desc: 'Cr√©ation entreprise sur formalites.entreprises.gouv.fr (remplace P0PL/M0)', amount: 'Frais de greffe (~37 ‚Ç¨)', priorit√©: 'haute', √©ch√©ance: 'S-6' },
    { id: 'oec', titre: 'Inscription au Tableau CROEC', desc: 'Via Espace Pro Comptexpert - Dossier 14j avant Commission du Tableau', amount: 'Variable selon CROEC', priorit√©: 'haute', √©ch√©ance: 'S-6' },
    { id: 'rcp', titre: 'Souscrire assurance RCP', desc: 'Obligatoire avant tout demarrage (decret 2025-483, 1er juil. 2025)', amount: '~800-1 500 ‚Ç¨/an', priorit√©: 'haute', √©ch√©ance: 'S-4' },
    { id: 'cavec', titre: 'Affiliation CAVEC (retraite complementaire)', desc: isTNS ? 'Regime obligatoire EC - Classe A minimum (TNS)' : 'Regime obligatoire EC - Classe C minimum (assimile-salarie)', amount: isTNS ? 'A partir de 898 ‚Ç¨' : 'A partir de 5 554 ‚Ç¨', priorit√©: 'haute', √©ch√©ance: 'S-2' }
  ];
  
  if (isTNS) {
    items.push({ id: 'cavec-base', titre: 'CAVEC - Retraite de base (CNAVPL)', desc: 'Cotisation minimale obligatoire - Regime de base professions lib√©rales', amount: '~573 ‚Ç¨ min.', priorit√©: 'haute', √©ch√©ance: 'S-2' });
    items.push({ id: 'cavec-prev', titre: 'CAVEC Prevoyance (invalidite-deces)', desc: 'Classe 1 obligatoire', amount: '~288 ‚Ç¨', priorit√©: 'haute', √©ch√©ance: 'S-2' });
    items.push({ id: 'urssaf', titre: 'Declaration URSSAF TNS', desc: 'Cotisations forfaitaires 1ere annee (g√©rant majoritaire SARL/SELARL)', amount: '~3 500 ‚Ç¨ (forfait)', priorit√©: 'haute', √©ch√©ance: 'S-2' });
  }
  
  items.push({ id: 'cotisation', titre: 'Cotisation ordinale annuelle', desc: 'Cotisation au CROEC - Variable selon region', amount: '~500-1 000 ‚Ç¨', priorit√©: 'haute', √©ch√©ance: 'S-2' });
  items.push({ id: 'dgfip', titre: 'Creer espace professionnel DGFIP', desc: 'Acces teleservices fiscaux (TVA, IS/IR)', amount: 'Gratuit', priorit√©: 'haute', √©ch√©ance: 'S0' });
  
  // Recommand√©s
  items.push({ id: 'businessstory', titre: 'S\'inscrire sur Business Story (prospection)', desc: 'Levier de prospection gratuit de l\'Ordre - L\'EC offre 3 RDV a des porteurs de projets pour les convertir en clients', amount: 'Gratuit', priorit√©: 'moyenne', √©ch√©ance: 'S0+' });
  items.push({ id: 'cjec', titre: 'Adherer au CJEC', desc: 'Reseau des jeunes experts-comptables', amount: '~150 ‚Ç¨/an', priorit√©: 'moyenne', √©ch√©ance: 'S0+' });
  
  // Optionnels
  items.push({ id: 'ifec', titre: 'Adh√©sion syndicale (IFEC/ECF)', desc: 'Representation professionnelle, formations', amount: 'Variable', priorit√©: 'basse', √©ch√©ance: 'S0+' });
  items.push({ id: 'bni', titre: 'Adh√©sion BNI', desc: 'R√©seau structur√© de recommandations', amount: '~2 000-2 900 ‚Ç¨ (annee 1)', priorit√©: 'basse', √©ch√©ance: 'S0+' });
  items.push({ id: 'cjd', titre: 'Adh√©sion CJD', desc: 'Mouvement de dirigeants engages', amount: 'Variable', priorit√©: 'basse', √©ch√©ance: 'S0+' });
  items.push({ id: 'dfcg', titre: 'Adh√©sion DFCG', desc: 'Reseau directeurs financiers - Positionnement DAF externalise', amount: '~217-350 ‚Ç¨/an', priorit√©: 'basse', √©ch√©ance: 'S0+' });
  
  const obligatoires = items.filter(i => i.priorit√© === 'haute').length;
  const recommand√©s = items.filter(i => i.priorit√© === 'moyenne').length;
  const optionnels = items.filter(i => i.priorit√© === 'basse').length;
  document.getElementById('statObligatoires').textContent = obligatoires;
  document.getElementById('statRecommand√©s').textContent = recommand√©s;
  document.getElementById('statOptionnels').textContent = optionnels;
  
  let html = '<div class="insight-box info" style="margin-bottom:20px;"><strong>Note :</strong> Les montants affiches sont des ordres de grandeur indicatifs. Pour le chiffrage detaille et personnalise, consultez l\'Annexe 7 (previsionnel financier).</div>';
  
  const sections = [
    { label: 'üî¥ Obligations (priorit√© haute)', filter: 'haute' },
    { label: 'üü° Recommand√©s', filter: 'moyenne' },
    { label: 'üîµ Optionnels', filter: 'basse' }
  ];
  
  sections.forEach(section => {
    const sectionItems = items.filter(i => i.priorit√© === section.filter);
    if (sectionItems.length === 0) return;
    html += '<div class="category-title">' + section.label + '</div>';
    sectionItems.forEach(item => {
      const checked = checklistState[item.id] ? 'checked' : '';
      const checkedClass = checklistState[item.id] ? 'checked' : '';
      html += '<div class="checklist-item priorit√©-' + item.priorit√© + ' ' + checkedClass + '">' +
        '<div class="checklist-checkbox"><input type="checkbox" ' + checked + ' onchange="toggleChecklist(\'' + item.id + '\')"></div>' +
        '<div class="checklist-content">' +
          '<div class="checklist-title">' + item.titre + ' <span style="float:right;font-size:11px;color:var(--gray-500);font-weight:500;">' + item.√©ch√©ance + '</span></div>' +
          '<div class="checklist-desc">' + item.desc + '</div>' +
          '<div class="checklist-amount">Ordre de grandeur : ' + item.amount + '</div>' +
          '<span class="checklist-link" onclick="focusOrg(\'' + item.id + '\')">Voir fiche complete ‚Üí</span>' +
        '</div></div>';
    });
  });
  
  container.innerHTML = html;
  updateStats();
}

function toggleChecklist(id) {
  checklistState[id] = !checklistState[id];
  renderChecklist();
}

function renderAnnuaire() {
  const container = document.getElementById('annuaireContainer');
  const search = (document.getElementById('searchInput')?.value || '').toLowerCase();
  
  const categories = [
    { id: 'ordinal', nom: 'A. Cadre ordinal & instances', icon: 'üèõÔ∏è' },
    { id: 'dispositif', nom: 'B. D√©veloppement &amp; prospection', icon: 'üõ†Ô∏è' },
    { id: 'obligation', nom: 'C. Obligations', icon: '‚ö†Ô∏è' },
    { id: 'reseau', nom: 'D. R√©seaux & clubs', icon: 'ü§ù' }
  ];
  
  let html = '';
  categories.forEach(cat => {
    const orgs = organismes.filter(o => {
      if (o.categorie !== cat.id) return false;
      if (search) {
        return (o.nom + ' ' + o.keywords + ' ' + o.role).toLowerCase().includes(search);
      }
      return true;
    });
    
    if (orgs.length === 0) return;
    
    html += `<div class="category-section"><div class="category-title"><span>${cat.icon}</span> ${cat.nom}</div>`;
    
    orgs.forEach(org => {
      const tags = org.tags.map(t => {
        let cls = 'tag-optionnel';
        if (t === 'obligatoire') cls = 'tag-obligatoire';
        if (t === 'recommand√©') cls = 'tag-recommand√©';
        if (t === 'cac') cls = 'tag-cac';
        if (t === 'conditionnel') cls = 'tag-conditionnel';
        return `<span class="tag ${cls}">${t.charAt(0).toUpperCase() + t.slice(1)}</span>`;
      }).join('');
      
      const quandList = org.quand ? org.quand.map(q => `<li>${q}</li>`).join('') : '';
      
      let directLinksHtml = '';
      if (org.directLinks && org.directLinks.length > 0) {
        directLinksHtml = `<div class="direct-links"><h5>Liens directs</h5>${org.directLinks.map(dl => `<div class="direct-link-item"><span>üìé</span><a href="${dl.url}" target="_blank">${dl.label}</a></div>`).join('')}</div>`;
      }
      
      html += `
        <div class="org-card" id="org-${org.id}">
          <div class="org-header ${org.categorie}" onclick="toggleOrg('${org.id}')">
            <div class="org-title">${org.nom}</div>
            <div class="org-tags">${tags}</div>
          </div>
          <div class="org-body">
            <div class="info-grid">
              <div class="info-label">Role</div>
              <div class="info-value">${org.role}</div>
              <div class="info-label">Quand solliciter</div>
              <div class="info-value"><ul>${quandList}</ul></div>
              ${org.site ? `<div class="info-label">Site officiel</div><div class="info-value"><a href="${org.site}" target="_blank">${org.siteLabel}</a></div>` : ''}
              <div class="info-label">Contact</div>
              <div class="info-value">${org.contact}</div>
              ${org.note ? `<div class="info-label">Note</div><div class="info-value" style="background: var(--gray-50); padding: 10px; border-radius: 8px;">${org.note}</div>` : ''}
            </div>
            ${directLinksHtml}
          </div>
        </div>
      `;
    });
    html += `</div>`;
  });
  
  container.innerHTML = html || '<p style="text-align: center; color: var(--gray-500);">Aucun organisme trouve.</p>';
}

function filterOrganismes() { renderAnnuaire(); }

function getStateObject() {
  return {
    meta: {
      savedAt: new Date().toISOString(),
      formeJuridique: document.getElementById('formeJuridique').value,
      situation: document.getElementById('situation').value,
      priorit√©: document.getElementById('priorit√©').value,
      region: document.getElementById('region').value,
      projetCAC: document.getElementById('projetCAC').value,
    },
    checklistState
  };
}

function applyStateObject(state) {
  if (!state) return;
  document.getElementById('formeJuridique').value = state.meta?.formeJuridique || 'liberal';
  document.getElementById('situation').value = state.meta?.situation || 'creation';
  document.getElementById('priorit√©').value = state.meta?.priorit√© || 'conformit√©';
  document.getElementById('region').value = state.meta?.region || '';
  document.getElementById('projetCAC').value = state.meta?.projetCAC || 'non';
  
  if (state.checklistState) {
    Object.keys(state.checklistState).forEach(k => { checklistState[k] = state.checklistState[k]; });
  }
  

  
  updateStatutSocial();
  renderAll();
}

let autoSaveTimeout;
function autoSave() {
  clearTimeout(autoSaveTimeout);
  autoSaveTimeout = setTimeout(() => {
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(getStateObject())); } catch (e) {}
  }, 500);
}

function resetAll() {
  if (!confirm('Reinitialiser toutes les donnees ?')) return;
  initState();
  try { localStorage.removeItem(STORAGE_KEY); } catch (e) {}
  location.reload();
}

function exportJSON() {
  const obj = getStateObject();
  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'annexe5-mon-dossier-' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  URL.revokeObjectURL(url);
  toast('Dossier exporte avec succes');
}

function importJSON(event) {
  const file = event.target.files?.[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      applyStateObject(JSON.parse(reader.result));
      toast('Dossier charge avec succes');
    } catch (e) {
      toast('Fichier invalide');
    }
    event.target.value = '';
  };
  reader.readAsText(file);
}

function exportPDF() {
  toast('Generation du PDF en cours...');
  
  setTimeout(function() {
    try {
      var jsPDF = window.jspdf.jsPDF;
      var doc = new jsPDF('p', 'mm', 'a4');
      var pageWidth = doc.internal.pageSize.getWidth();
      var pageHeight = doc.internal.pageSize.getHeight();
      var margin = 15;
      var contentWidth = pageWidth - 2 * margin;
      var y = 0;
      var pageNum = 0;
      var totalPages = 4;

      var primaryR = 30, primaryG = 58, primaryB = 95;
      var secondaryR = 13, secondaryG = 148, secondaryB = 136;

      function cleanText(text) {
        if (!text) return '';
        return String(text)
          .replace(/[\u{1F300}-\u{1F9FF}]/gu, '')
          .replace(/[\u{2600}-\u{26FF}]/gu, '')
          .replace(/[\u{2700}-\u{27BF}]/gu, '')
          .replace(/[üèõÔ∏è‚öñÔ∏èüë•üé§üöÄüíªüõ°Ô∏èüè¶üìãüè¢üìäüå±ü§ùüè™üîóüë§üí∞üìÖ‚úÖüìñüìöüó∫Ô∏è‚ö†Ô∏èüí°üîçüìéüñ®Ô∏èüíæüìÇüóëÔ∏èüîÑüìù]/g, '')
          .replace(/√©/g, 'e').replace(/√®/g, 'e').replace(/√™/g, 'e').replace(/√´/g, 'e')
          .replace(/√†/g, 'a').replace(/√¢/g, 'a').replace(/√§/g, 'a')
          .replace(/√π/g, 'u').replace(/√ª/g, 'u').replace(/√º/g, 'u')
          .replace(/√Æ/g, 'i').replace(/√Ø/g, 'i')
          .replace(/√¥/g, 'o').replace(/√∂/g, 'o')
          .replace(/√ß/g, 'c').replace(/√á/g, 'C')
          .replace(/√â/g, 'E').replace(/√à/g, 'E').replace(/√ä/g, 'E')
          .replace(/√Ä/g, 'A').replace(/√Ç/g, 'A')
          .replace(/['']/g, "'").replace(/[""]/g, '"')
          .replace(/‚Ä¶/g, '...').replace(/[‚Äì‚Äî]/g, '-')
          .replace(/¬∞/g, ' ')
          .trim();
      }

      function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
      }

      function checkPageBreak(neededSpace) {
        if (y + neededSpace > pageHeight - 25) {
          addPageFooter();
          doc.addPage();
          pageNum++;
          y = 20;
          return true;
        }
        return false;
      }

      function addPageFooter() {
        doc.setDrawColor(200, 200, 200);
        doc.setLineWidth(0.3);
        doc.line(margin, pageHeight - 18, pageWidth - margin, pageHeight - 18);
        doc.setFontSize(8);
        doc.setTextColor(120, 120, 120);
        doc.setFont('helvetica', 'normal');
        doc.text('Annexe 5 \u2014 Ecosyst\u00e8me professionnel du cabinet 100 % num\u00e9rique | Source : r\u00e9alis\u00e9 par le candidat', margin, pageHeight - 12);
        doc.text('Page ' + pageNum + ' / ' + totalPages, pageWidth - margin - 20, pageHeight - 12);
      }

      function addSectionHeader(title) {
        checkPageBreak(18);
        doc.setFillColor(primaryR, primaryG, primaryB);
        doc.rect(margin, y, contentWidth, 12, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.text(cleanText(title), margin + 5, y + 8);
        y += 18;
        doc.setTextColor(0, 0, 0);
      }

      function addSubHeader(title) {
        checkPageBreak(10);
        doc.setFontSize(10);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(primaryR, primaryG, primaryB);
        doc.text(cleanText(title), margin, y);
        y += 6;
        doc.setTextColor(0, 0, 0);
      }

      function addParagraph(text) {
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(60, 60, 60);
        var lines = doc.splitTextToSize(cleanText(text), contentWidth);
        for (var i = 0; i < lines.length; i++) {
          checkPageBreak(5);
          doc.text(lines[i], margin, y);
          y += 4.5;
        }
        y += 2;
      }

      function addBullet(text) {
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(60, 60, 60);
        var bulletText = '- ' + cleanText(text);
        var lines = doc.splitTextToSize(bulletText, contentWidth - 5);
        for (var i = 0; i < lines.length; i++) {
          checkPageBreak(5);
          doc.text(lines[i], margin + 3, y);
          y += 4.5;
        }
      }

      function addTable(headers, rows, colWidths) {
        var tableWidth = 0;
        for (var i = 0; i < colWidths.length; i++) tableWidth += colWidths[i];
        var startX = margin;
        var rowH = 8;
        var headerH = 9;

        checkPageBreak(headerH + Math.min(rows.length, 5) * rowH + 5);

        doc.setFillColor(primaryR, primaryG, primaryB);
        doc.rect(startX, y, tableWidth, headerH, 'F');
        doc.setFontSize(8);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(255, 255, 255);
        
        var x = startX;
        for (var h = 0; h < headers.length; h++) {
          doc.text(cleanText(headers[h]), x + 3, y + 6);
          x += colWidths[h];
        }
        y += headerH;

        for (var r = 0; r < rows.length; r++) {
          checkPageBreak(rowH + 2);
          
          if (r % 2 === 0) {
            doc.setFillColor(245, 247, 250);
          } else {
            doc.setFillColor(255, 255, 255);
          }
          doc.rect(startX, y, tableWidth, rowH, 'F');
          doc.setDrawColor(220, 220, 220);
          doc.setLineWidth(0.1);
          doc.rect(startX, y, tableWidth, rowH, 'S');
          
          x = startX;
          doc.setFontSize(8);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(50, 50, 50);
          
          for (var c = 0; c < rows[r].length; c++) {
            var cellText = cleanText(String(rows[r][c]));
            var maxW = colWidths[c] - 6;
            while (doc.getTextWidth(cellText) > maxW && cellText.length > 3) {
              cellText = cellText.slice(0, -1);
            }
            doc.text(cellText, x + 3, y + 5.5);
            x += colWidths[c];
          }
          y += rowH;
        }
        y += 5;
      }

      // === PDF GENERATION ===
      var formeJuridique = document.getElementById('formeJuridique')?.value || 'liberal';
      var situation = document.getElementById('situation')?.value || 'creation';
      var priorit√© = document.getElementById('priorit√©')?.value || 'conformit√©';
      var region = document.getElementById('region')?.value || '';
      var projetCAC = document.getElementById('projetCAC')?.value || 'Non';
      var isTNS = (formeJuridique !== 'sas' && formeJuridique !== 'selas');
      var statutSocial = isTNS ? 'TNS (Travailleur Non Salarie)' : 'Assimile-salarie (regime g√©n√©ral)';

      var formeLabels = {
        'liberal': 'Exercice liberal (BNC)',
        'sarl': 'SARL / EURL (g√©rant majoritaire)',
        'sas': 'SAS / SASU (president)',
        'selarl': 'SELARL (g√©rant majoritaire)',
        'selas': 'SELAS (president)'
      };

      // PAGE 1
      pageNum = 1;

      doc.setFillColor(primaryR, primaryG, primaryB);
      doc.rect(0, 0, pageWidth, 45, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(18);
      doc.setFont('helvetica', 'bold');
      doc.text('ANNEXE 5', margin, 18);
      
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      doc.text('Carte Mentale : OEC, D√©veloppement, Obligations, R√©seaux', margin, 28);
      
      doc.setFontSize(9);
      doc.text('Outil d\'orientation pour l\'expert-comptable en cr√©ation', margin, 37);
      
      doc.setFontSize(8);
      doc.text('Genere le ' + new Date().toLocaleDateString('fr-FR'), pageWidth - margin - 35, 37);

      y = 53;

      doc.setFillColor(245, 247, 250);
      doc.roundedRect(margin, y, contentWidth, 28, 2, 2, 'F');
      doc.setDrawColor(200, 200, 200);
      doc.roundedRect(margin, y, contentWidth, 28, 2, 2, 'S');
      
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(primaryR, primaryG, primaryB);
      doc.text('PROFIL DU PORTEUR DE PROJET', margin + 5, y + 7);
      
      doc.setFont('helvetica', 'normal');
      doc.setTextColor(60, 60, 60);
      doc.setFontSize(8);
      doc.text('Forme juridique : ' + cleanText(formeLabels[formeJuridique] || formeJuridique), margin + 5, y + 14);
      doc.text('Statut social : ' + cleanText(statutSocial), margin + 5, y + 20);
      doc.text('Phase : ' + cleanText(situation), margin + 100, y + 14);
      doc.text('Region : ' + (region ? cleanText(region) : 'Non renseignee'), margin + 100, y + 20);
      doc.text('Projet CAC : ' + cleanText(projetCAC), margin + 100, y + 26);

      y += 36;

      addSubHeader('Objectif de cette annexe');
      addParagraph('Cette carte mentale constitue un outil d\'orientation visuel et pratique pour l\'expert-comptable en phase de creation ou de premiere inscription. Elle pr√©sent√© l\'ecosyst√®me professionnel structure en 4 categories et adapte les obligations au statut juridique choisi.');

      y += 2;

      addSubHeader('Structure de l\'ecosyst√®me professionnel');
      y += 2;

      var structureRows = [
        ['A', 'Cadre Ordinal', 'OEC/CROEC, H2A (si CAC), CJEC, Syndicats'],
        ['B', 'D√©veloppement & prospection', 'Business Story (prospection, gratuit), France Num (positionnement)'],
        ['C', 'Obligations', 'Guichet Unique INPI, RCP, CAVEC' + (isTNS ? ', URSSAF TNS' : '') + ', DGFIP'],
        ['D', 'Reseaux', 'DFCG, Reseau Entreprendre, CJD, CCI, BNI']
      ];
      addTable(['Cat.', 'Categorie', 'Organismes'], structureRows, [15, 40, 125]);

      y += 4;

      addSubHeader('Checklist des d√©marches prioritaires');
      y += 2;

      var checklistItems = [
        ['1', 'Formalites Guichet Unique INPI', 'S-6', 'Obligatoire'],
        ['2', 'Inscription au Tableau CROEC', 'S-6', 'Obligatoire'],
        ['3', 'Souscription assurance RCP', 'S-4', 'Obligatoire'],
        ['4', 'Affiliation CAVEC', 'S-2', 'Obligatoire']
      ];
      if (isTNS) {
        checklistItems.push(['5', 'Declaration URSSAF TNS', 'S-2', 'Obligatoire (TNS)']);
        checklistItems.push(['6', 'Espace professionnel DGFIP', 'S0', 'Obligatoire']);
        checklistItems.push(['7', 'Adh√©sion CJEC + Business Story', 'S0+', 'Recommand√©']);
      } else {
        checklistItems.push(['5', 'Espace professionnel DGFIP', 'S0', 'Obligatoire']);
        checklistItems.push(['6', 'Adh√©sion CJEC + Business Story', 'S0+', 'Recommand√©']);
      }
      addTable(['N.', 'D√©marche', '√âch√©ance', 'Statut'], checklistItems, [12, 85, 30, 53]);

      addPageFooter();

      // PAGE 2
      doc.addPage();
      pageNum = 2;
      y = 20;

      addSectionHeader('2. ANNUAIRE DES ORGANISMES');

      addSubHeader('A. Cadre Ordinal');
      y += 2;

      var ordinalRows = [
        ['OEC / CROEC', 'Inscription Tableau, d√©ontologie, contr√¥le qualit√©', 'Obligatoire'],
        ['H2A (ex-H3C)', 'Supervision CAC et auditeurs durabilit√©', 'Si activit√© CAC'],
        ['CJEC', 'Accompagnement installation, echanges pairs', 'Recommand√©'],
        ['IFEC / ECF', 'Representation, defense interets profession', 'Optionnel']
      ];
      addTable(['Organisme', 'Role', 'Statut'], ordinalRows, [40, 105, 35]);

      addSubHeader('B. D√©veloppement & prospection');
      y += 2;

      var dispositifsRows = [
        ['Business Story', 'Prospection : l\'EC offre 3 RDV gratuits aux porteurs de projets', 'Gratuit'],
        ['France Num (initiative gouv.)', 'Positionnement : devenir Activateur France Num (annuaire national)', 'Gratuit']
      ];
      addTable(['Levier', 'Description', 'Acces'], dispositifsRows, [40, 115, 25]);

      addSubHeader('C. Obligations r√©glementaires');
      y += 2;

      var obligationsRows = [
        ['Guichet Unique INPI', 'Formalites creation (remplace P0PL/M0)', 'Obligatoire', 'Frais greffe'],
        ['Assurance RCP', 'Responsabilit√© civile professionnelle', 'Obligatoire', '800 EUR/an'],
        ['CAVEC', 'Regime retraite obligatoire EC', 'Obligatoire', '898-8282 EUR']
      ];
      if (isTNS) {
        obligationsRows.push(['URSSAF TNS', 'Cotisations sociales g√©rant majoritaire', 'Si TNS', '~3500 EUR']);
      }
      obligationsRows.push(['DGFIP', 'TVA, IS/IR, declarations fiscales', 'Obligatoire', '-']);
      addTable(['Organisme', 'Role', 'Statut', 'Estimation'], obligationsRows, [38, 72, 30, 40]);

      if (!isTNS) {
        y += 2;
        doc.setFillColor(239, 246, 255);
        doc.roundedRect(margin, y, contentWidth, 14, 2, 2, 'F');
        doc.setFillColor(37, 99, 235);
        doc.rect(margin, y, 3, 14, 'F');
        doc.setFontSize(8);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(30, 64, 175);
        doc.text('NOTE : President SAS/SELAS', margin + 8, y + 5);
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(7);
        doc.text('Vous etes assimile-salarie : cotisations via DSN (regime g√©n√©ral), pas d\'URSSAF TNS.', margin + 8, y + 10);
        y += 18;
      }

      addSubHeader('D. Reseaux professionnels');
      y += 2;

      var reseauxRows = [
        ['DFCG', 'Reseau directeurs financiers', '350 EUR/an'],
        ['Reseau Entreprendre', 'Accompagnement entrepreneurs, prets honneur', 'Variable'],
        ['CJD', 'Mouvement dirigeants engages', 'Variable selon section'],
        ['CCI', 'Animation economique locale', 'Variable'],
        ['BNI', 'R√©seau structur√© de recommandations', '~2 000 EUR (1ere annee)']
      ];
      addTable(['Reseau', 'Description', 'Estimation'], reseauxRows, [45, 100, 35]);

      addPageFooter();


      // PAGE 3
      doc.addPage();
      pageNum = 3;
      y = 20;

      addSectionHeader('4. CALENDRIER ET ECHEANCES CLES');

      var calendarRows = [
        ['S-6', 'Formalites Guichet Unique INPI', 'formalites.entreprises.gouv.fr'],
        ['S-6', 'Dossier inscription CROEC', 'Via Espace Pro Comptexpert'],
        ['S-4', 'Souscription assurance RCP', 'Decret 2025-483 (1er juillet 2025)'],
        ['S-2', 'Affiliation CAVEC' + (isTNS ? ' + URSSAF TNS' : ''), 'Choix classe cotisation'],
        ['S0', 'Inscription effective au Tableau', 'D√©but officiel activit√©'],
        ['S0+', 'Activation d√©veloppement', 'Business Story (prospection), CJEC, 1 reseau max'],
        ['Sept. 2026', 'Facturation √©lectronique : reception', 'Toutes entreprises'],
        ['Sept. 2027', 'Facturation √©lectronique : emission', 'PME et TPE']
      ];
      addTable(['√âch√©ance', 'Action', 'Detail'], calendarRows, [28, 78, 74]);

      y += 3;

      addSectionHeader('5. REFERENTIELS ET SOURCES');

      addSubHeader('Textes officiels');
      y += 2;

      addBullet('Ordonnance n 45-2138 du 19 septembre 1945 - Statut de l\'Ordre');
      addBullet('Decret n 2012-432 du 30 mars 2012 - Code de d√©ontologie');
      addBullet('Decret n 2022-1014 du 19 juillet 2022 - Creation du Guichet Unique INPI');
      addBullet('Arrete du 26 decembre 2023 - Procedure continuite Infogreffe 2024 (expiree 31/12/2024)');
      addBullet('Decret n 2025-483 du 30 mai 2025 - Obligation RCP renforcee');
      addBullet('Ordonnance n 2023-1142 du 6 decembre 2023 - Creation H2A (ex-H3C)');
      addBullet('Loi de finances 2024 (art. 91) - Calendrier facturation √©lectronique');
      addBullet('LFSS 2024 (art. 18) - Reforme assiette URSSAF ind√©pendants (application effective 2026)');

      y += 4;

      addSubHeader('Sources des donnees chiffrees');
      y += 2;

      addBullet('CAVEC - Baremes 2026 (publies le 21 janvier 2026) : www.cavec.fr');
      addBullet('Guichet Unique INPI : formalites.entreprises.gouv.fr');
      addBullet('Espace Pro Comptexpert : espace-pro.oec-paris.fr');
      addBullet('URSSAF - Cotisations TNS 1ere annee : www.urssaf.fr');

      y += 6;

      doc.setFillColor(245, 247, 250);
      doc.roundedRect(margin, y, contentWidth, 24, 2, 2, 'F');
      doc.setDrawColor(200, 200, 200);
      doc.roundedRect(margin, y, contentWidth, 24, 2, 2, 'S');
      
      doc.setFontSize(9);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(primaryR, primaryG, primaryB);
      doc.text('SOURCE : REALISE PAR LE CANDIDAT', margin + 5, y + 7);
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(7);
      doc.setTextColor(100, 100, 100);
      doc.text('Document genere le ' + new Date().toLocaleDateString('fr-FR') + ' a ' + new Date().toLocaleTimeString('fr-FR'), margin + 5, y + 13);
      doc.text('Outil d\'orientation pour le memoire DEC - Verifiez les textes officiels avant toute d√©marche.', margin + 5, y + 18);
      doc.text('Les formulaires P0PL et M0 sont obsol√®tes depuis le 1er janvier 2023 (Guichet Unique INPI).', margin + 5, y + 22);

      addPageFooter();

      doc.save('Annexe_5_Carte_Mentale_OEC.pdf');
      toast('PDF export√© avec succ√®s !');

    } catch (e) {
      console.error('Erreur PDF:', e);
      alert('Erreur lors de la g√©n√©ration du PDF : ' + e.message);
    }
  }, 200);
}

function loadCasPratique() {
  // Chargement direct du cas pratique
  
  // Reset state
  initState();
  
  // Cabinet X : SARL g√©rant majoritaire, inscription obtenue (S0+), √éle-de-France
  // Sc√©nario r√©aliste : toutes les obligations S-6 √† S0 faites, d√©but du d√©veloppement
  const casPratique = {
    meta: {
      savedAt: new Date().toISOString(),
      formeJuridique: 'sarl',
      situation: 'installation',
      priorit√©: 'dev',
      region: '√éle-de-France',
      projetCAC: 'non'
    },
    checklistState: {
      // Obligations S-6 √† S0 : TOUTES FAITES
      'guichet-unique': true,
      'oec': true,
      'rcp': true,
      'cavec': true,
      'cavec-base': true,
      'cavec-prev': true,
      'urssaf': true,
      'cotisation': true,
      'dgfip': true,
      // Recommand√©s : Business Story activ√©, CJEC en cours
      'businessstory': true,
      'cjec': false,
      // Optionnels : pas encore
      'ifec': false,
      'bni': false,
      'cjd': false,
      'dfcg': false,
      'francenum': false,
      'h2a': false,
      'reseauentreprendre': false,
      'cci': false
    }
  };
  
  applyStateObject(casPratique);
  autoSave();
  toast('Cas pratique Cabinet X charg√© ‚Äî SARL, phase S0+, 10/15 d√©marches accomplies');
}

// Init
(function init() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) applyStateObject(JSON.parse(raw));
    else {
      updateStatutSocial();
      renderAll();
    }
  } catch (e) {
    updateStatutSocial();
    renderAll();
  }
})();
</script>
</body>
</html>
